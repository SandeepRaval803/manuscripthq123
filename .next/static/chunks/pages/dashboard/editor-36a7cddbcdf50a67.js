(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[764],{14277:(e,t,a)=>{"use strict";a.d(t,{A:()=>h});var s=a(37876),r=a(14232),l=a(89983),n=a(57391),i=a(53397),c=a(35627),o=a(83707),d=a(97685),u=a(12099);let m={part:"Add New Part",chapter:"Add New Chapter",scene:"Add New Scene"};function h(e){let{isOpen:t,onClose:a,onSubmit:h,parentOptions:x=[],initialType:p="chapter",refresh:g,setRefresh:f,selectedParentId:v}=e,{token:j,user:y}=(0,u.A)(),[b,N]=(0,r.useState)({title:"",type:p,parent:v||""}),[w,C]=(0,r.useState)(!1),[k,A]=(0,r.useState)([]),[S,E]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(null==y?void 0:y.selectedManuscript)&&j&&(async()=>{E(!0);try{let e=await fetch("https://apis.manuscripthq.com/api/section/get?manuscriptId=".concat(null==y?void 0:y.selectedManuscript._id),{method:"GET",headers:{"Content-Type":"application/json","auth-token":j}}),t=await e.json();"success"===t.status?A(t.data):d.Ay.error(t.message||"Failed to load parts.")}catch(e){d.Ay.error("Failed to load parts."),console.error("Error fetching parts:",e)}finally{E(!1)}})()},[t,b.type,j,y]),(0,r.useEffect)(()=>{if(t){let e=v?"chapter":"part";N(t=>({...t,title:"",type:e,parent:v||""}))}},[t,v]);let L=async e=>{e.preventDefault(),C(!0);try{let e={...b,parent:"part"===b.type?null:b.parent,manuscriptId:y.selectedManuscript._id},t=await fetch("https://apis.manuscripthq.com/api/section/create",{method:"POST",headers:{"Content-Type":"application/json","auth-token":j},body:JSON.stringify(e)}),s=await t.json();"success"===s.status?(h(s.data),d.Ay.success("Created successfully!"),a(),f(!g)):d.Ay.error(s.message||"An error occurred. Please try again.")}catch(e){d.Ay.error("Failed to create the section. Please try again."),console.error(e)}finally{C(!1)}};return(0,s.jsx)(n.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(n.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(n.c7,{children:[(0,s.jsx)(n.L3,{children:m[b.type]||"Add New Chapter"}),(0,s.jsxs)(n.rr,{children:["Create a new ",b.type," for your manuscript."]})]}),(0,s.jsxs)("form",{onSubmit:L,children:[(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(c.J,{htmlFor:"title",className:"text-right",children:"Title"}),(0,s.jsx)(i.p,{id:"title",name:"title",value:b.title,onChange:e=>{let{name:t,value:a}=e.target;N(e=>({...e,[t]:a}))},className:"col-span-3",placeholder:"Enter title",required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(c.J,{htmlFor:"type",className:"text-right",children:"Type"}),(0,s.jsxs)(o.l6,{value:b.type,onValueChange:e=>N({...b,type:e,parent:""}),children:[(0,s.jsx)(o.bq,{id:"type",className:"col-span-3",children:(0,s.jsx)(o.yv,{placeholder:"Select type"})}),(0,s.jsxs)(o.gC,{children:[(0,s.jsx)(o.eb,{value:"part",children:"Part"}),(0,s.jsx)(o.eb,{value:"chapter",children:"Chapter"}),(0,s.jsx)(o.eb,{value:"scene",children:"Scene"})]})]})]}),"part"!==b.type&&(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(c.J,{htmlFor:"parent",className:"text-right",children:"Parent"}),(0,s.jsxs)(o.l6,{value:b.parent||void 0,onValueChange:e=>N({...b,parent:e}),disabled:S||0===k.length,children:[(0,s.jsx)(o.bq,{id:"parent",className:"col-span-3",children:(0,s.jsx)(o.yv,{placeholder:S?"Loading...":"Select parent"})}),(0,s.jsx)(o.gC,{children:k.length>0&&k.map(e=>(0,s.jsx)(o.eb,{value:e._id,children:e.title},e._id))})]})]})]}),(0,s.jsxs)(n.Es,{children:[(0,s.jsx)(l.$,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),(0,s.jsx)(l.$,{type:"submit",className:"bg-primary",disabled:w,children:w?"Creating...":"Create"})]})]})]})})}},18632:(e,t,a)=>{"use strict";a.d(t,{w:()=>n});var s=a(37876);a(14232);var r=a(76924),l=a(8488);function n(e){let{className:t,orientation:a="horizontal",decorative:n=!0,...i}=e;return(0,s.jsx)(r.b,{"data-slot":"separator-root",decorative:n,orientation:a,className:(0,l.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...i})}},44162:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/editor",function(){return a(85441)}])},72195:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>c,av:()=>o,j7:()=>i,tU:()=>n});var s=a(37876);a(14232);var r=a(90491),l=a(8488);function n(e){let{className:t,...a}=e;return(0,s.jsx)(r.bL,{"data-slot":"tabs",className:(0,l.cn)("flex flex-col gap-2",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)(r.B8,{"data-slot":"tabs-list",className:(0,l.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)(r.l9,{"data-slot":"tabs-trigger",className:(0,l.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)(r.UC,{"data-slot":"tabs-content",className:(0,l.cn)("flex-1 outline-none",t),...a})}},85441:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>es});var s=a(37876),r=a(14232),l=a(46953),n=a(89717),i=a(93327),c=a(89983),o=a(89081),d=a(72195),u=a(65390),m=a(99986),h=a(93468),x=a(79015),p=a(17952),g=a(6368),f=a(32243),v=a(55969),j=a(51865),y=a(70034),b=a(47832),N=a(32196),w=a(97216),C=a(14564),k=a(18465),A=a(18632),S=a(22060),E=a(97685);function L(e){let{open:t,value:a,onChange:r,onClose:l,onInsert:n}=e;if(!t)return null;let i=()=>{if(!a.trim().startsWith("https://"))return void E.Ay.error("Please Enter a Valid Link ");a.trim()&&n()};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-96",children:[(0,s.jsx)("div",{className:"text-lg font-bold mb-2 text-primary",children:"Insert Link"}),(0,s.jsx)("input",{className:"w-full p-2 mb-4 border border-primary rounded",placeholder:"https://your-link.com",autoFocus:!0,value:a,onChange:e=>r(e.target.value),onKeyDown:e=>{"Enter"===e.key&&i(),"Escape"===e.key&&l()}}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)(c.$,{onClick:l,size:"sm",variant:"outline",children:"Cancel"}),(0,s.jsx)(c.$,{onClick:i,size:"sm",className:"bg-primary text-white",disabled:!a.trim(),children:"Insert"})]})]})})}function R(e){let{open:t,onClose:a,onInsert:l}=e,[n,i]=(0,r.useState)(null),[o,d]=(0,r.useState)(null);(0,r.useEffect)(()=>{t||(i(null),d(null))},[t]);let u=e=>{if(!e)return;i(e);let t=new FileReader;t.onloadend=()=>d(t.result),t.readAsDataURL(e)};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-5 w-[500px]",children:[(0,s.jsx)("div",{className:"text-lg font-bold mb-2 text-primary",children:"Insert Image"}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-primary rounded-xl flex flex-col items-center justify-center p-5 mb-4 cursor-pointer transition hover:bg-[#eaa8f9]/10",onDrop:e=>{e.preventDefault(),e.dataTransfer.files&&e.dataTransfer.files[0]&&u(e.dataTransfer.files[0])},onDragOver:e=>e.preventDefault(),onClick:()=>{var e;return null==(e=document.getElementById("image-file-input"))?void 0:e.click()},children:[o?(0,s.jsx)("img",{src:o||"/placeholder.svg",alt:"preview",className:"max-h-52 mb-2 rounded"}):(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsxs)("svg",{height:"48",width:"48",className:"mb-2 text-primary",viewBox:"0 0 48 48",children:[(0,s.jsx)("circle",{cx:"24",cy:"24",r:"22",fill:"#eaa8f9"}),(0,s.jsx)("path",{d:"M24 16v12m0 0l-5-5m5 5l5-5",stroke:"#CA24D6",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"})]}),(0,s.jsx)("div",{className:"font-semibold text-primary",children:"Drop your files here"}),(0,s.jsxs)("div",{className:"text-gray-600",children:["or"," ",(0,s.jsx)("span",{className:"text-black underline",children:"browse for files"}),"."]}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Select up to 1 file"})]}),(0,s.jsx)("input",{type:"file",accept:"image/*",id:"image-file-input",className:"hidden",onChange:e=>{e.target.files&&e.target.files[0]&&u(e.target.files[0])}})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)(c.$,{onClick:a,size:"sm",variant:"outline",children:"Cancel"}),(0,s.jsx)(c.$,{onClick:()=>{n&&l(n)},size:"sm",disabled:!o,className:"bg-primary text-white",children:"Insert"})]})]})}):null}var T=a(53397),I=a(12089),M=a(70672),z=a(55851),$=a(15961),_=a(70291),F=a(92406),H=a(33276);function P(e){var t,a,l,n,i,o,u,m,h,x,p,g,f,b,N,w,C,k,A,S;let{open:L,imageElement:R,onClose:P,onSave:D,onDelete:W}=e,[q,U]=(0,r.useState)({width:300,height:200}),[O,B]=(0,r.useState)("none"),[X,K]=(0,r.useState)({x:0,y:0,width:100,height:100}),[G,Z]=(0,r.useState)(""),V=(0,r.useRef)(null),J=(0,r.useRef)(null),[Y,Q]=(0,r.useState)(!1),[ee,et]=(0,r.useState)("resize"),[ea,es]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(L&&R){var e;U({width:Number.parseInt(R.style.width)||R.width||300,height:Number.parseInt(R.style.height)||R.height||200}),Z(R.src),es(!1);let t=R.style.float||"none",a=(null==(e=R.parentElement)?void 0:e.style.textAlign)||"none";"left"===t?B("left"):"right"===t?B("right"):"center"===a?B("center"):B("none"),Q(!1)}},[L,R]);let er=async e=>{try{let t=await new Promise(t=>e.toBlob(t,"image/png")),a=new FormData;a.append("image",t,"cropped-image.png");let s=await fetch("https://apis.manuscripthq.com/api/utility/upload-image",{method:"POST",body:a});return(await s.json()).imageUrl}catch(e){throw console.error("Error uploading cropped image:",e),e}},el=async()=>{if(!J.current||!V.current)return null;let e=V.current,t=e.getContext("2d"),a=J.current;e.width=X.width,e.height=X.height;try{t.clearRect(0,0,e.width,e.height),t.drawImage(a,X.x,X.y,X.width,X.height,0,0,X.width,X.height);try{return e.toDataURL("image/png")}catch(t){return await er(e)}}catch(e){return console.error("Error cropping image:",e),E.Ay.error("Failed to crop image. Please try again."),null}},en=async()=>{if(!R)return;let e=G;if("crop"===ee&&!ea)try{let t=await el();if(!t)return void E.Ay.error("Failed to crop image");e=t}catch(e){E.Ay.error("Failed to crop image due to CORS restrictions");return}D({src:e,width:q.width,height:q.height,alignment:O})},ei=e=>{if(!J.current)return;let{naturalWidth:t,naturalHeight:a}=J.current;switch(e){case"crop-top-20":K({x:0,y:.2*a,width:t,height:.8*a}),E.Ay.success("Cropped top 20% of the image");break;case"crop-bottom-20":K({x:0,y:0,width:t,height:.8*a}),E.Ay.success("Cropped bottom 20% of the image");break;case"crop-left-20":K({x:.2*t,y:0,width:.8*t,height:a}),E.Ay.success("Cropped left 20% of the image");break;case"crop-right-20":K({x:0,y:0,width:.8*t,height:a}),E.Ay.success("Cropped right 20% of the image");break;case"crop-center-80":K({x:.1*t,y:.1*a,width:.8*t,height:.8*a}),E.Ay.success("Cropped to center 80% of the image");break;case"crop-square":let s=Math.min(t,a);K({x:(t-s)/2,y:(a-s)/2,width:s,height:s}),E.Ay.success("Cropped to center square");break;default:K({x:0,y:0,width:t,height:a}),E.Ay.success("Reset to original size")}};return L?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-primary",children:"Edit Image"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{window.confirm("Are you sure you want to delete this image?")&&(W(),P())},className:"text-red-600 hover:text-red-700 bg-transparent",children:[(0,s.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Delete Image"]}),(0,s.jsx)(c.$,{variant:"ghost",size:"icon",onClick:P,children:(0,s.jsx)(M.A,{className:"h-5 w-5"})})]})]}),ea&&(0,s.jsx)("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(z.A,{className:"h-5 w-5 text-yellow-600 mr-2"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-yellow-800",children:"CORS Restriction"}),(0,s.jsx)("p",{className:"text-sm text-yellow-700",children:"This image cannot be cropped due to cross-origin restrictions. You can still resize and align it."})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Preview"}),(0,s.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[400px] flex items-center justify-center bg-gray-50",children:G&&(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsx)("img",{ref:J,src:G||"/placeholder.svg",alt:"Preview",crossOrigin:"anonymous",style:{width:"".concat(Math.min(q.width,400),"px"),height:"".concat(Math.min(q.height,300),"px"),objectFit:"cover"},onLoad:()=>{if(Q(!0),J.current){let e=J.current;K({x:0,y:0,width:e.naturalWidth,height:e.naturalHeight})}},onError:()=>{es(!0),E.Ay.error("Unable to load image for cropping due to CORS restrictions")},className:"\n                          ".concat("left"===O?"float-left mr-4":"","\n                          ").concat("right"===O?"float-right ml-4":"","\n                          ").concat("center"===O?"mx-auto block":"","\n                        ")}),"crop"===ee&&Y&&!ea&&(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,s.jsx)("div",{className:"absolute bg-black/40",style:{left:0,top:0,width:"".concat(X.x/(null==(t=J.current)?void 0:t.naturalWidth)*100,"%"),height:"100%"}}),(0,s.jsx)("div",{className:"absolute bg-black/40",style:{right:0,top:0,width:"".concat(((null==(a=J.current)?void 0:a.naturalWidth)-X.x-X.width)/(null==(l=J.current)?void 0:l.naturalWidth)*100,"%"),height:"100%"}}),(0,s.jsx)("div",{className:"absolute bg-black/40",style:{left:"".concat(X.x/(null==(n=J.current)?void 0:n.naturalWidth)*100,"%"),top:0,width:"".concat(X.width/(null==(i=J.current)?void 0:i.naturalWidth)*100,"%"),height:"".concat(X.y/(null==(o=J.current)?void 0:o.naturalHeight)*100,"%")}}),(0,s.jsx)("div",{className:"absolute bg-black/40",style:{left:"".concat(X.x/(null==(u=J.current)?void 0:u.naturalWidth)*100,"%"),bottom:0,width:"".concat(X.width/(null==(m=J.current)?void 0:m.naturalWidth)*100,"%"),height:"".concat(((null==(h=J.current)?void 0:h.naturalHeight)-X.y-X.height)/(null==(x=J.current)?void 0:x.naturalHeight)*100,"%")}}),(0,s.jsx)("div",{className:"absolute border-2 border-green-500",style:{left:"".concat(X.x/(null==(p=J.current)?void 0:p.naturalWidth)*100,"%"),top:"".concat(X.y/(null==(g=J.current)?void 0:g.naturalHeight)*100,"%"),width:"".concat(X.width/(null==(f=J.current)?void 0:f.naturalWidth)*100,"%"),height:"".concat(X.height/(null==(b=J.current)?void 0:b.naturalHeight)*100,"%")},children:(0,s.jsxs)("div",{className:"absolute -top-8 left-0 bg-green-500 text-white text-xs px-2 py-1 rounded",children:["Keep: ",Math.round(X.width)," \xd7 ",Math.round(X.height)]})})]})]}),"none"!==O&&"center"!==O&&(0,s.jsxs)("div",{className:"text-sm text-gray-500 mt-2 clear-both",children:["Sample text will wrap around the image when aligned ",O,". This is how your text will flow alongside the image in your document."]})]})}),(0,s.jsx)("canvas",{ref:V,className:"hidden"})]}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)(d.tU,{value:ee,onValueChange:et,children:[(0,s.jsxs)(d.j7,{className:"grid w-full grid-cols-3",children:[(0,s.jsx)(d.Xi,{value:"resize",children:"Resize"}),(0,s.jsx)(d.Xi,{value:"align",children:"Align"}),(0,s.jsxs)(d.Xi,{value:"crop",disabled:ea,children:["Crop ",ea&&"\uD83D\uDEAB"]})]}),(0,s.jsx)(d.av,{value:"resize",className:"space-y-4",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Width (px)"}),(0,s.jsx)(T.p,{type:"number",value:q.width,onChange:e=>U(t=>({...t,width:Number.parseInt(e.target.value)||0})),className:"mt-2",min:"50",max:"800"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Height (px)"}),(0,s.jsx)(T.p,{type:"number",value:q.height,onChange:e=>U(t=>({...t,height:Number.parseInt(e.target.value)||0})),className:"mt-2",min:"50",max:"600"})]}),(0,s.jsxs)(c.$,{variant:"outline",onClick:()=>{if(J.current){let e=J.current,t=e.naturalWidth/e.naturalHeight;U({width:Math.round(q.height*t),height:q.height})}},className:"w-full",children:[(0,s.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Maintain Aspect Ratio"]}),(0,s.jsx)("div",{className:"p-3 bg-blue-50 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800",children:["\uD83D\uDCA1 ",(0,s.jsx)("strong",{children:"Tip:"})," Use the aspect ratio button to maintain image proportions while resizing."]})})]})}),(0,s.jsxs)(d.av,{value:"align",className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Image Alignment"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[(0,s.jsxs)(c.$,{variant:"left"===O?"default":"outline",onClick:()=>B("left"),className:"flex items-center justify-center",children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Left"]}),(0,s.jsxs)(c.$,{variant:"center"===O?"default":"outline",onClick:()=>B("center"),className:"flex items-center justify-center",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Center"]}),(0,s.jsxs)(c.$,{variant:"right"===O?"default":"outline",onClick:()=>B("right"),className:"flex items-center justify-center",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Right"]}),(0,s.jsx)(c.$,{variant:"none"===O?"default":"outline",onClick:()=>B("none"),className:"flex items-center justify-center",children:"None"})]})]}),(0,s.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg",children:[(0,s.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Alignment Guide:"}),(0,s.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Left:"})," Image floats left, text wraps on the right"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Right:"})," Image floats right, text wraps on the left"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Center:"})," Image is centered, text above and below"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"None:"})," Image follows normal document flow"]})]})]})]}),(0,s.jsx)(d.av,{value:"crop",className:"space-y-4",children:Y&&!ea&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"p-3 bg-green-50 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-green-800",children:["✂️ ",(0,s.jsx)("strong",{children:"Simple Cropping:"})," Click the buttons below to remove parts of your image. The green area shows what you'll keep!"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium mb-3 block",children:"Quick Crop Options"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)(c.$,{variant:"outline",onClick:()=>ei("crop-top-20"),className:"flex items-center justify-center h-12",children:[(0,s.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Remove Top 20%"]}),(0,s.jsxs)(c.$,{variant:"outline",onClick:()=>ei("crop-bottom-20"),className:"flex items-center justify-center h-12",children:[(0,s.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Remove Bottom 20%"]}),(0,s.jsxs)(c.$,{variant:"outline",onClick:()=>ei("crop-left-20"),className:"flex items-center justify-center h-12",children:[(0,s.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Remove Left 20%"]}),(0,s.jsxs)(c.$,{variant:"outline",onClick:()=>ei("crop-right-20"),className:"flex items-center justify-center h-12",children:[(0,s.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Remove Right 20%"]}),(0,s.jsxs)(c.$,{variant:"outline",onClick:()=>ei("crop-center-80"),className:"flex items-center justify-center h-12",children:[(0,s.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Keep Center 80%"]}),(0,s.jsxs)(c.$,{variant:"outline",onClick:()=>ei("crop-square"),className:"flex items-center justify-center h-12",children:[(0,s.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Make Square"]})]})]}),(0,s.jsxs)("details",{className:"border rounded-lg p-3",children:[(0,s.jsx)("summary",{className:"cursor-pointer font-medium text-sm",children:"Advanced Manual Controls"}),(0,s.jsx)("div",{className:"mt-3 space-y-3",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs",children:"X Position"}),(0,s.jsx)(T.p,{type:"number",value:Math.round(X.x),onChange:e=>K(t=>({...t,x:Number.parseInt(e.target.value)||0})),min:"0",max:(null==(N=J.current)?void 0:N.naturalWidth)||0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs",children:"Y Position"}),(0,s.jsx)(T.p,{type:"number",value:Math.round(X.y),onChange:e=>K(t=>({...t,y:Number.parseInt(e.target.value)||0})),min:"0",max:(null==(w=J.current)?void 0:w.naturalHeight)||0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs",children:"Width"}),(0,s.jsx)(T.p,{type:"number",value:Math.round(X.width),onChange:e=>K(t=>({...t,width:Number.parseInt(e.target.value)||0})),min:"10",max:(null==(C=J.current)?void 0:C.naturalWidth)||0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs",children:"Height"}),(0,s.jsx)(T.p,{type:"number",value:Math.round(X.height),onChange:e=>K(t=>({...t,height:Number.parseInt(e.target.value)||0})),min:"10",max:(null==(k=J.current)?void 0:k.naturalHeight)||0})]})]})})]}),(0,s.jsx)("div",{className:"p-4 bg-yellow-50 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,s.jsx)(F.A,{className:"h-4 w-4 inline mr-1"}),"Original: ",null==(A=J.current)?void 0:A.naturalWidth," \xd7 ",null==(S=J.current)?void 0:S.naturalHeight," px | Will keep:"," ",Math.round(X.width)," \xd7 ",Math.round(X.height)," px"]})})]})})]})})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t",children:[(0,s.jsx)(c.$,{variant:"outline",onClick:P,children:"Cancel"}),(0,s.jsxs)(c.$,{onClick:en,className:"bg-primary text-white",children:[(0,s.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Apply Changes"]})]})]})})}):null}let D=function(){return(0,s.jsx)(o.Zp,{className:"border-primary p-1",children:(0,s.jsxs)(o.Wu,{className:"p-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-primary mb-2",children:"Keyboard Shortcuts"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:[{key:"Ctrl+B",action:"Bold"},{key:"Ctrl+I",action:"Italic"},{key:"Ctrl+U",action:"Underline"},{key:"Ctrl+Z",action:"Undo"},{key:"Ctrl+Y",action:"Redo"}].map((e,t)=>(0,s.jsxs)(S.E,{variant:"outline",className:"border-primary text-primary text-xs",children:[e.key," - ",e.action]},t))})]})})};var W=a(12099),q=a(23157);function U(e){let{selectedNodeId:t,onContentChange:a}=e,[l,n]=(0,r.useState)(null),[i,d]=(0,r.useState)(""),[T,I]=(0,r.useState)([""]),[M,z]=(0,r.useState)(0),$=(0,r.useRef)(null),_=(0,r.useRef)(null),F=(0,r.useRef)(!1),[H,U]=(0,r.useState)(!1),[O,B]=(0,r.useState)(""),[X,K]=(0,r.useState)(!1),[G,Z]=(0,r.useState)(!1),[V,J]=(0,r.useState)(!1),{token:Y}=(0,W.A)(),[Q,ee]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if(!t||!Y){d(""),$.current&&($.current.innerHTML=""),J(!0);return}Z(!0),J(!1);try{let e=await fetch("https://apis.manuscripthq.com/api/editor/getContentBySectionId?sectionId=".concat(t),{method:"GET",headers:{"Content-Type":"application/json","auth-token":Y}}),a=await e.json();if("success"===a.status){let e=a.data||"";d(e),I([e]),z(0),setTimeout(()=>{$.current&&($.current.innerHTML=e,$.current.focus(),$.current.blur(),J(!0))},100)}else d(""),$.current&&($.current.innerHTML=""),I([""]),z(0),J(!0)}catch(e){E.Ay.error("Failed to load content for this section"),d(""),$.current&&($.current.innerHTML=""),I([""]),z(0),J(!0)}finally{Z(!1)}})()},[t,Y]),(0,r.useEffect)(()=>{$.current&&$.current.innerHTML!==i&&($.current.innerHTML=i)},[i]),(0,r.useEffect)(()=>{a&&a(i)},[i,a]),(0,r.useEffect)(()=>{let e=e=>{var t;"IMG"===e.target.tagName&&(null==(t=$.current)?void 0:t.contains(e.target))&&(e.preventDefault(),ex(e.target))};if($.current)return $.current.addEventListener("click",e),()=>{$.current&&$.current.removeEventListener("click",e)}},[V]),(0,r.useEffect)(()=>{V&&$.current&&$.current.querySelectorAll("img").forEach(e=>{var t,a;let s=null==(t=e.parentElement)?void 0:t.querySelector(".image-delete-btn");if(s&&s.remove(),!(null==(a=e.parentElement)?void 0:a.classList.contains("image-wrapper"))){let t=document.createElement("div");t.className="image-wrapper relative inline-block group",e.parentNode.insertBefore(t,e),t.appendChild(e);let a=document.createElement("button");a.className="image-delete-btn absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center text-xs hover:bg-red-600 z-10",a.innerHTML="\xd7",a.title="Delete image",a.addEventListener("click",e=>{if(e.stopPropagation(),e.preventDefault(),window.confirm("Are you sure you want to delete this image?")){t.remove();let e=$.current.innerHTML;d(e),es(e),E.Ay.success("Image deleted successfully")}}),t.appendChild(a)}})},[V,i]);let es=(0,r.useCallback)(e=>{if(e===i)return;let t=T.slice(0,M+1);t.push(e),I(t),z(t.length-1)},[T,M,i]),er=(0,r.useCallback)((e,t)=>{if($.current){if($.current.focus(),"bold"===e)document.execCommand("bold");else if("italic"===e)document.execCommand("italic");else if("underline"===e)document.execCommand("underline");else if("strikeThrough"===e)document.execCommand("strikeThrough");else if("justifyLeft"===e)document.execCommand("justifyLeft");else if("justifyCenter"===e)document.execCommand("justifyCenter");else if("justifyRight"===e)document.execCommand("justifyRight");else if("formatBlock"===e){let a=window.getSelection();if(a&&0===a.rangeCount){let e=document.createRange();e.selectNodeContents($.current),e.collapse(!1),a.removeAllRanges(),a.addRange(e)}if(!document.execCommand(e,!1,t)&&"formatBlock"===e&&t){let e=window.getSelection();if(e&&e.rangeCount>0){let a=e.getRangeAt(0),s=document.createElement(t.replace(/[<>]/g,""));try{a.surroundContents(s)}catch(e){s.appendChild(a.extractContents()),a.insertNode(s)}e.removeAllRanges();let r=document.createRange();r.setStartAfter(s),r.collapse(!0),e.addRange(r)}}}else if("createLink"===e&&t){let e=window.getSelection();if(e&&e.toString().trim())document.execCommand("createLink",!1,t);else{let e='<a href="'.concat(t,'" target="_blank" rel="noopener noreferrer">').concat(t,"</a>");document.execCommand("insertHTML",!1,e)}}else if("insertImage"===e&&t){let e='<div class="image-wrapper relative inline-block group">\n            <img src="'.concat(t,'" alt="Inserted image" style="max-width: 100%; height: auto; margin: 10px 0;" />\n            <button class="image-delete-btn absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center text-xs hover:bg-red-600 z-10" title="Delete image">\xd7</button>\n          </div>');document.execCommand("insertHTML",!1,e)}let a=$.current.innerHTML;d(a),es(a)}},[es]),el=(0,r.useCallback)(e=>{if($.current){$.current.focus(),document.execCommand("insertHTML",!1,e);let t=$.current.innerHTML;d(t),es(t)}},[es]),en=(0,r.useCallback)(()=>{if(M>0){let e=M-1,t=T[e];F.current=!0,z(e),d(t),$.current&&($.current.innerHTML=t)}},[M,T]),ei=(0,r.useCallback)(()=>{if(M<T.length-1){let e=M+1,t=T[e];F.current=!0,z(e),d(t),$.current&&($.current.innerHTML=t)}},[M,T]),ec=(0,r.useCallback)(()=>{if($.current&&V&&!G){let e=$.current.innerHTML;if(F.current){F.current=!1;return}d(e),_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{e!==T[M]&&es(e)},600)}},[V,G,T,M,es]),eo=(0,r.useCallback)(e=>{if(e.ctrlKey||e.metaKey)switch(e.key){case"b":e.preventDefault(),er("bold");break;case"i":e.preventDefault(),er("italic");break;case"u":e.preventDefault(),er("underline");break;case"z":e.preventDefault(),e.shiftKey?ei():en();break;case"y":e.preventDefault(),ei()}},[er,en,ei]),{wordCount:ed,charCount:eu}=(()=>{var e;let t=(null==(e=$.current)?void 0:e.textContent)||"";return{wordCount:t.trim()?t.trim().split(/\s+/).length:0,charCount:t.length}})(),em=async e=>{let t=new FormData;t.append("image",e);let a=await fetch("https://apis.manuscripthq.com/api/utility/upload-image",{method:"POST",body:t});return(await a.json()).imageUrl||null},eh=async e=>{if(e)try{let t=await em(e);t?(er("insertImage",t),K(!1)):E.Ay.error("Failed to upload image. Please try again.")}catch(e){E.Ay.error("Failed to upload image. Please try again.")}},ex=e=>{ea(e),ee(!0)};return(0,s.jsxs)("div",{className:"w-full max-w-6xl mx-auto space-y-3",children:[(0,s.jsx)(D,{}),(0,s.jsx)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-[#eaa8f9]/20 to-transparent rounded-lg border border-primary",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)(S.E,{variant:"secondary",className:"bg-[#eaa8f9] text-primary font-medium",children:["Words: ",ed]}),(0,s.jsxs)(S.E,{variant:"outline",className:"border-primary text-primary",children:["Characters: ",eu]})]})}),(0,s.jsx)(o.Zp,{className:"p-0 border-primary",children:(0,s.jsxs)(o.Wu,{className:"p-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-primary",children:[(0,s.jsxs)("div",{className:"flex items-center px-4 py-2 bg-primary text-white font-semibold rounded-lg border border-primary",children:[(0,s.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Write"]}),(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"icon",onClick:en,disabled:M<=0,className:"text-primary hover:bg-[#eaa8f9] disabled:opacity-50",title:"Undo (Ctrl+Z)",children:(0,s.jsx)(m.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"icon",onClick:ei,disabled:M>=T.length-1,className:"text-primary hover:bg-[#eaa8f9] disabled:opacity-50",title:"Redo (Ctrl+Y)",children:(0,s.jsx)(h.A,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 p-4 bg-gradient-to-r from-[#eaa8f9]/20 to-transparent border-b border-primary",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("bold"),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Bold (Ctrl+B)",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("italic"),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Italic (Ctrl+I)",children:(0,s.jsx)(p.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("underline"),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Underline (Ctrl+U)",children:(0,s.jsx)(g.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("strikeThrough"),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Strikethrough",children:(0,s.jsx)(f.A,{className:"h-4 w-4"})})]}),(0,s.jsx)(A.w,{orientation:"vertical",className:"h-6 bg-primary/30"}),(0,s.jsx)("div",{className:"flex items-center gap-1",children:[1,2,3,4,5,6].map(e=>(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("formatBlock","h".concat(e)),className:"text-primary hover:bg-[#eaa8f9] hover:text-black text-xs font-bold ".concat(l==="formatBlock:h".concat(e)?"bg-primary text-white":""),title:"Heading ".concat(e),children:"H".concat(e)},e))}),(0,s.jsx)(A.w,{orientation:"vertical",className:"h-6 bg-primary/30"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("justifyLeft"),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Align Left",children:(0,s.jsx)(v.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("justifyCenter"),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Align Center",children:(0,s.jsx)(j.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>er("justifyRight"),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Align Right",children:(0,s.jsx)(y.A,{className:"h-4 w-4"})})]}),(0,s.jsx)(A.w,{orientation:"vertical",className:"h-6 bg-primary/30"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>{if($.current){$.current.focus();let e=window.getSelection();if(e&&0===e.rangeCount){let t=document.createRange();t.selectNodeContents($.current),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}if(document.execCommand("insertUnorderedList",!1,null)){let e=$.current.innerHTML;d(e),es(e)}else el("<ul><li>List item</li></ul>")}},className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Bullet List",children:(0,s.jsx)(b.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>{if($.current){$.current.focus();let e=window.getSelection();if(e&&0===e.rangeCount){let t=document.createRange();t.selectNodeContents($.current),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}if(document.execCommand("insertOrderedList",!1,null)){let e=$.current.innerHTML;d(e),es(e)}else el("<ol><li>List item</li></ol>")}},className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Numbered List",children:(0,s.jsx)(N.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>el('<blockquote style="border-left: 4px solid #CA24D6; padding-left: 16px; margin: 16px 0; font-style: italic;">Quote text here</blockquote>'),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Quote",children:(0,s.jsx)(w.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>U(!0),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Insert Link",children:(0,s.jsx)(C.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>K(!0),className:"text-primary hover:bg-[#eaa8f9] hover:text-black",title:"Insert Image",children:(0,s.jsx)(k.A,{className:"h-4 w-4"})})]})]}),G?(0,s.jsx)("div",{className:"flex items-center justify-center my-4",children:(0,s.jsx)(q.A,{})}):(0,s.jsx)("div",{ref:$,contentEditable:!0,className:"min-h-[400px] p-6 focus:outline-none text-gray-800 leading-relaxed [&_img]:cursor-pointer [&_img]:transition-all [&_.image-wrapper]:relative [&_.image-wrapper]:inline-block",style:{fontFamily:"ui-serif, Georgia, serif"},onInput:ec,onKeyDown:eo,"data-placeholder":t?"Start writing your content here... Use the toolbar above or keyboard shortcuts (Ctrl+B for bold, Ctrl+I for italic, etc.)":"Please select a section from the outline to start writing..."})]})}),(0,s.jsx)(L,{open:H,value:O,onChange:B,onClose:()=>{U(!1),B("")},onInsert:()=>{if(O.trim()){let e=O.trim();e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e),er("createLink",e),U(!1),B("")}}}),(0,s.jsx)(R,{open:X,onClose:()=>K(!1),onInsert:eh}),(0,s.jsx)(P,{open:Q,imageElement:et,onClose:()=>{ee(!1),ea(null)},onSave:e=>{if(!et)return;switch(et.src=e.src,et.style.width="".concat(e.width,"px"),et.style.height="".concat(e.height,"px"),et.style.float="",et.style.display="",et.style.margin="",e.alignment){case"left":et.style.float="left",et.style.marginRight="16px",et.style.marginBottom="8px";break;case"right":et.style.float="right",et.style.marginLeft="16px",et.style.marginBottom="8px";break;case"center":et.style.display="block",et.style.margin="16px auto"}let t=$.current.innerHTML;d(t),es(t),ee(!1),ea(null),E.Ay.success("Image updated successfully!")},onDelete:()=>{if(et){let e=et.closest(".image-wrapper");e?e.remove():et.remove();let t=$.current.innerHTML;d(t),es(t),E.Ay.success("Image deleted successfully!")}}})]})}var O=a(65104),B=a(10345),X=a(45199),K=a(99297),G=a(94723),Z=a(30822),V=a(96108),J=a(65662),Y=a(43596),Q=a(14e3),ee=a(14277);let et=()=>{let[e,t]=(0,r.useState)(!1),[a,l]=(0,r.useState)([]),[n,i]=(0,r.useState)({}),{user:u,token:m}=(0,W.A)(),[h,x]=(0,r.useState)(!0),[p,g]=(0,r.useState)(null),[f,v]=(0,r.useState)(""),[j,y]=(0,r.useState)(!1),b=(0,Q.useRouter)(),N=(0,Q.useSearchParams)(),[w,C]=(0,r.useState)(!1),[k,A]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(null==u?void 0:u.selectedManuscript)&&(async()=>{x(!0);let e=await (0,G.XU)(null==u?void 0:u.selectedManuscript._id,m);if(e.success){l(e.sections),x(!1);let t=N.get("active");t&&(g(t),S(t,e.sections))}else l([]),x(!1)})()},[null==u?void 0:u.selectedManuscript,m,k]);let S=(e,t)=>{let a=[],s=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(let l of t){let t=[...r,l._id];if(l._id===e)return a.push(...r),!0;if(l.children&&s(l.children,t))return!0}return!1};s(t);let r={...n};a.forEach(e=>{r[e]=!0}),i(r)},L=(0,r.useCallback)((e,t,a)=>{if(t&&i(t=>{let a={...t},s=a[e]||!1;return a[e]=!s,a}),a){g(e);let t=new URLSearchParams(N.toString());t.set("active",e),b.replace("?".concat(t.toString()))}},[b,N]);(0,r.useEffect)(()=>{let e=N.get("active");e&&g(e)},[N]);let R=async()=>{if(!p)return void E.Ay.error("Please select a section to save content to");if(!f.trim())return void E.Ay.error("No content to save");y(!0);try{let e={manuscriptId:u.selectedManuscript._id,sectionId:p,content:f},t=await fetch("https://apis.manuscripthq.com/api/editor/createOrUpdate",{method:"POST",headers:{"Content-Type":"application/json","auth-token":m},body:JSON.stringify(e)}),a=await t.json();"success"===a.status||t.ok?E.Ay.success("Content saved successfully!"):E.Ay.error(a.message||"Failed to save content. Please try again.")}catch(e){console.error("Error saving content:",e),E.Ay.error("Failed to save content. Please try again.")}finally{y(!1)}},T=(0,r.useCallback)(()=>{C(!0)},[]),I=(0,r.useCallback)(e=>{v(e)},[]),M=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=e.children&&e.children.length>0,r=n[e._id]||!1,l=e._id===p,i=t>0||"chapter"===e.type;return(0,s.jsxs)("div",{style:{paddingLeft:"".concat(16*t+8,"px")},children:[(0,s.jsxs)("div",{className:"group flex items-center gap-2 rounded-md px-2 py-1.5 mb-1 transition-colors cursor-pointer ".concat(l?"border-[#eaa8f9] border-2 bg-[#eaa8f9]/20":""," ").concat(i?"hover:bg-gray-100":"hover:bg-gray-50"),role:"button",onClick:()=>L(e._id,a,i),children:[a?(0,s.jsx)("div",{className:"h-5 w-5 text-primary rounded flex items-center justify-center transition-colors",children:r?(0,s.jsx)(Z.A,{className:"h-4 w-4"}):(0,s.jsx)(V.A,{className:"h-4 w-4"})}):(0,s.jsx)("div",{className:"ml-5",children:"scene"===e.type?(0,s.jsx)(J.A,{className:"h-4 w-4 text-primary"}):(0,s.jsx)(Y.A,{className:"h-4 w-4 text-primary"})}),(0,s.jsx)("span",{className:"flex-1 truncate font-medium ".concat(0===t?"text-slate-700 font-semibold":"text-slate-900"," ").concat(i?"":"text-slate-600"),children:e.title}),!i&&a&&(0,s.jsx)("span",{className:"text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded",children:e.type})]}),a&&r&&(0,s.jsx)("ul",{children:e.children.map(e=>M(e,t+1))})]},e._id)};return(0,s.jsxs)("div",{className:"flex-1 space-y-4 p-4 md:p-6 pt-6 ".concat(e?"fixed top-0 left-0 w-full h-full bg-white z-50":""),children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"mb-1 text-3xl font-bold text-primary",children:"Manuscript Editor"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Create, edit, and organize your manuscript with ease in a seamless writing environment."})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(c.$,{className:"bg-primary flex items-center space-x-1",onClick:R,disabled:j||!p,children:[(0,s.jsx)(B.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:j?"Saving...":"Save"})]}),(0,s.jsxs)(c.$,{variant:"outline",className:"border-[#eaa8f9] text-primary flex items-center space-x-2 bg-transparent",onClick:()=>{e?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),t(!e)},disabled:!p,children:[e?(0,s.jsx)(X.A,{className:"h-4 w-4"}):(0,s.jsx)(K.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e?"Exit Full Screen":"Full Screen"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-4",children:[(0,s.jsx)(o.Zp,{className:"col-span-1 md:col-span-1",children:(0,s.jsxs)(d.tU,{defaultValue:"outline",className:"w-full px-2",children:[(0,s.jsx)(d.j7,{className:"grid w-full grid-cols-1 bg-[#eaa8f9]",children:(0,s.jsx)(d.Xi,{value:"outline",className:"data-[state=active]:text-primary cursor-pointer",children:"Outline"})}),(0,s.jsx)(d.av,{value:"outline",className:"my-4",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"font-medium",children:"Manuscript Structure"}),h?(0,s.jsx)(q.A,{}):0===a.length?(0,s.jsx)("div",{className:"text-center text-muted-foreground",children:(0,s.jsx)("div",{className:"space-y-3",children:(0,s.jsx)(c.$,{onClick:()=>T(),className:"bg-primary",children:(0,s.jsx)(O.A,{className:"h-5 w-5"})})})}):(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:a.map(e=>M(e))})]})})]})}),p?(0,s.jsx)(o.Zp,{className:"col-span-1 md:col-span-3 p-4",children:(0,s.jsx)(U,{selectedNodeId:p,onContentChange:I})}):(0,s.jsx)(o.Zp,{className:"col-span-3 md:col-span-3 flex flex-col items-center justify-center h-160",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground p-8",children:[(0,s.jsx)(Y.A,{className:"mx-auto h-12 w-12 text-primary mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No Section Selected"}),(0,s.jsx)("p",{className:"mb-4",children:"Select a section from the manuscript structure to begin editing."})]})})]})]}),(0,s.jsx)(ee.A,{isOpen:w,onClose:()=>C(!1),onSubmit:e=>{let t={_id:e._id,title:e.title,type:e.type,wordCount:e.wordCount||0,status:e.status||"draft",children:e.children||[]};if(!e.parent){if(l(e=>[...e,t]),"chapter"===e.type||"scene"===e.type){g(e._id);let t=new URLSearchParams(N.toString());t.set("active",e._id),b.replace("?".concat(t.toString())),E.Ay.success("".concat(e.title," created and selected!"))}setTimeout(()=>{A(!k)},100);return}let a=s=>s.map(s=>s._id===e.parent?{...s,children:[...s.children||[],t]}:s.children?{...s,children:a(s.children)}:s);if(l(e=>a(e)),i(t=>({...t,[e.parent]:!0})),"chapter"===e.type||"scene"===e.type){g(e._id);let t=new URLSearchParams(N.toString());t.set("active",e._id),b.replace("?".concat(t.toString())),E.Ay.success("".concat(e.title," created and selected!"))}setTimeout(()=>{A(!k)},100)},selectedParentId:null,refresh:k,setRefresh:A})]})};function ea(){let{isExpanded:e}=(0,i.c)();return(0,s.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,s.jsx)(l.e,{}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 w-0 ".concat(e?"md:ml-64":"md:ml-20"),style:{paddingTop:64},children:[(0,s.jsx)(n.V,{}),(0,s.jsx)("main",{className:"flex-1 overflow-auto",children:(0,s.jsx)(et,{})})]})]})}function es(){return(0,s.jsx)(i.G,{children:(0,s.jsx)(ea,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[134,644,121,657,323,669,636,593,792],()=>t(44162)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[768],{18066:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/subscription",function(){return t(77604)}])},77604:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>A});var r=t(37876),a=t(14232),i=t(46953),n=t(89717),l=t(93327),o=t(14463),c=t(33276),d=t(7446),m=t(4622),u=t(59116),x=t(70672),h=t(71416),p=t(89983),f=t(89081),g=t(89099),b=t(12099),j=t(97685),v=t(4241),y=t(61902),N=t(94723),w=t(65364);let P=(0,v.c)(w.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY||"pk_live_51RVZpqHDNUtmhWb0dJE5qyCpNeKSAfbFqS2RaU0de9ILnHFFjDg0gwzguVFSfvRIgkfx4LYeidqHbBUc6GqA5gtJ00IVLfPpN4"),C=e=>{let{onSuccess:s,onCancel:t}=e,i=(0,y.useStripe)(),n=(0,y.useElements)(),[l,o]=(0,a.useState)(!1),c=async e=>{if(e.preventDefault(),!i||!n)return;o(!0);let{error:t}=await i.confirmPayment({elements:n,confirmParams:{return_url:"".concat(window.location.origin,"/dashboard/subscription?success=true")}});t?j.oR.error(t.message):s(),o(!1)};return(0,r.jsxs)("form",{onSubmit:c,className:"space-y-6",children:[(0,r.jsx)(y.PaymentElement,{}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(p.$,{type:"button",variant:"outline",onClick:t,className:"flex-1",children:"Cancel"}),(0,r.jsx)(p.$,{type:"submit",disabled:!i||l,className:"flex-1 bg-gradient-to-r from-[#CA24D6] to-[#eaa8f9] text-white",children:l?"Processing...":"Pay Now"})]})]})};function _(){let e=(0,g.useRouter)(),{user:s,token:t,updateUser:i}=(0,b.A)(),[n,l]=(0,a.useState)(!1),[v,_]=(0,a.useState)(!1),[S,A]=(0,a.useState)(!1),[I,E]=(0,a.useState)(null),[D,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if("required"===e.query.upgrade&&l(!0),"true"===e.query.success){let e=async()=>{try{let e=new URLSearchParams(window.location.search),s=e.get("plan"),r=e.get("session_id"),a="",n="";if(r)try{let e=await fetch("/api/get-session-details?sessionId=".concat(r));if(e.ok){let s=await e.json();a=s.customerId||"",n=s.subscriptionId||""}}catch(e){console.error("Error fetching session details:",e)}else a=localStorage.getItem("stripe_customer_id")||"",n=localStorage.getItem("stripe_subscription_id")||"";let l={subscription:"premium"===s?"Premium":"Pro",stripeCustomerId:a,stripeSubscriptionId:n,subscriptionStatus:"ACTIVE",subscriptionStart:new Date().toISOString(),subscriptionEnd:new Date(Date.now()+2592e6).toISOString()},o=await (0,N.DG)(l,t);"success"===o.status?(i(o.user),j.oR.success("Your subscription has been updated to Premium!"),localStorage.removeItem("stripe_customer_id"),localStorage.removeItem("stripe_subscription_id")):j.oR.error("Failed to update subscription status")}catch(e){console.error("Error updating subscription:",e),j.oR.error("Failed to update subscription status")}};t&&e()}},[]);let R=async e=>{if(!t)return void j.oR.error("Please log in to continue");_(!0);try{let s=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({priceId:"premium"===e?w.env.NEXT_PUBLIC_STRIPE_PRICE_ID:w.env.NEXT_PUBLIC_STRIPE_PRICE_ID_PRO,successUrl:"".concat(window.location.origin,"/dashboard/subscription?success=true?plan=").concat(e),cancelUrl:"".concat(window.location.origin,"/dashboard/subscription")})});if(s.ok){let{url:e}=await s.json();window.location.href=e}else{let e=await fetch("https://apis.manuscripthq.com/api/stripepayment/subscription-sheet",{method:"POST",headers:{"Content-Type":"application/json","auth-token":t},body:JSON.stringify({priceId:w.env.NEXT_PUBLIC_STRIPE_PRICE_ID})}),s=await e.json();if(s.paymentIntent)s.customer&&localStorage.setItem("stripe_customer_id",s.customer),s.subscriptionId&&localStorage.setItem("stripe_subscription_id",s.subscriptionId),E(s.paymentIntent),A(!0),j.oR.success("Payment form ready!");else throw Error("No payment intent received")}}catch(e){console.error("Payment setup error:",e),j.oR.error("Failed to setup payment. Please try again.")}finally{_(!1)}},T=async()=>{if(!t)return void j.oR.error("Please log in to continue");try{_(!0);let e=await fetch("https://apis.manuscripthq.com/api/stripepayment/cancel-subscription",{method:"POST",headers:{"Content-Type":"application/json","auth-token":t},body:JSON.stringify({userId:null==s?void 0:s._id})}),r=await e.json();"success"===r.status?(i(r.user),j.oR.success("Subscription cancelled successfully!")):j.oR.error(r.message||"Failed to cancel subscription")}catch(e){console.error("Error cancelling subscription:",e),j.oR.error("Failed to cancel subscription. Please try again.")}finally{_(!1)}},F=(null==s?void 0:s.subscription)==="Premium",O=(null==s?void 0:s.subscription)==="Pro";return S&&I?(0,r.jsx)("div",{className:"min-h-screen bg-[#fafafa] p-4",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)(p.$,{variant:"outline",onClick:()=>A(!1),className:"mb-4",children:"â† Back to Plans"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Complete Payment"}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:(0,r.jsx)(y.Elements,{stripe:P,options:{clientSecret:I},children:(0,r.jsx)(C,{onSuccess:()=>{j.oR.success("Payment successful! Redirecting..."),localStorage.removeItem("stripe_customer_id"),localStorage.removeItem("stripe_subscription_id")},onCancel:()=>A(!1)})})})]})}):D?(0,r.jsx)("div",{className:"min-h-screen bg-[#fafafa] p-4 flex items-center justify-center",children:(0,r.jsx)("div",{className:"max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 border border-gray-100",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(o.A,{className:"w-8 h-8 text-red-500"})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:O?"Cancel Pro Plan?":"Cancel Premium Plan?"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Are you sure you want to switch back to the"," ",O?"Free plan":"Pro plan","? You'll lose access to all ",O?"pro":"premium"," features."]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)(p.$,{variant:"outline",onClick:()=>k(!1),className:"flex-1",children:["Keep ",O?"Pro":"Premium"]}),(0,r.jsx)(p.$,{onClick:T,className:"flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white",children:"Confirm Cancel"})]})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-[#fafafa] relative overflow-hidden",children:(0,r.jsxs)("div",{className:"relative z-10 p-4 md:p-6 pt-6",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"mb-1 text-3xl text-primary font-bold tracking-tight",children:"Choose Your Plan"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Select the perfect plan for your writing journey and unlock your creative potential"," "]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"relative group h-full ".concat("opacity-100"),children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-[#CA24D6]/30 via-[#eaa8f9]/20 to-[#CA24D6]/10 rounded-[2.5rem] blur opacity-50 group-hover:opacity-100 transition-opacity duration-500"}),(0,r.jsxs)(f.Zp,{className:"relative h-full bg-white backdrop-blur-xl border-0 rounded-[2rem] p-8 overflow-hidden transition-all duration-500 ".concat(F?"shadow-2xl ring-2 ring-[#CA24D6]/30":"shadow-lg group-hover:shadow-xl group-hover:-translate-y-1"),children:[(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#CA24D6] to-transparent"}),(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-[#CA24D6]/10 to-[#eaa8f9]/20 flex items-center justify-center shadow-inner",children:(0,r.jsx)(o.A,{className:"w-7 h-7 text-primary"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Premium Plan"}),(0,r.jsx)("p",{className:"text-gray-500",children:F?"Your current plan":"Access to all features"})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,r.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,r.jsx)("span",{className:"text-2xl font-bold text-gray-400 line-through",children:"$49.99"}),(0,r.jsx)("span",{className:"text-4xl font-bold text-primary",children:"$29.99"})]}),(0,r.jsx)("span",{className:"text-gray-500 ml-3 text-xl",children:"/month"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:F?"Active subscription":"Launch with confidence for just $29.99/mo (first 3 months)."})]})]}),(0,r.jsx)("div",{className:"space-y-5 mb-10 flex-grow",children:["Everything in Free Plan","Writing Analytics","Structured Editing","AI Formatting Tools","Final Manuscript Prep","Priority Customer Support","Advanced Analytics & Insights","Advanced Export Options"].map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-gradient-to-br from-[#CA24D6]/20 to-[#eaa8f9]/20 flex items-center justify-center",children:(0,r.jsx)(c.A,{className:"w-3.5 h-3.5 text-primary"})}),(0,r.jsx)("span",{className:"text-gray-700 text-sm",children:e})]},s))}),(0,r.jsx)(p.$,{className:"w-full font-medium py-6 rounded-xl shadow-lg transition-all duration-300 group ".concat(F?"bg-gradient-to-r from-red-500 to-red-600 text-white":"bg-primary hover:bg-primary/90 text-white hover:shadow-lg"),onClick:F?()=>k(!0):()=>R("premium"),disabled:v,children:(0,r.jsx)("span",{className:"flex items-center gap-2",children:v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.A,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):(0,r.jsxs)(r.Fragment,{children:[F?"Cancel Subscription":"Select Premium Plan",(0,r.jsx)(m.A,{className:"w-4 h-4 transition-transform ".concat(F?"group-hover:translate-x-1":"")})]})})})]})]})]}),(0,r.jsxs)("div",{className:"relative group h-full",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-[#CA24D6]/30 via-[#eaa8f9]/20 to-[#CA24D6]/10 rounded-[2.5rem] blur opacity-50 group-hover:opacity-100 transition-opacity duration-500"}),(0,r.jsxs)(f.Zp,{className:"relative h-full bg-white backdrop-blur-xl border border-[#CA24D6]/20 rounded-[2rem] p-8 overflow-hidden transition-all duration-500 shadow-lg group-hover:shadow-xl group-hover:-translate-y-1",children:[(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#CA24D6] to-transparent"}),(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-[#CA24D6]/20 to-[#eaa8f9]/20 flex items-center justify-center mx-auto mb-4 shadow-inner",children:(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#CA24D6] to-[#eaa8f9] flex items-center justify-center",children:(0,r.jsx)(c.A,{className:"w-5 h-5 text-white"})})}),(0,r.jsx)("h2",{className:"text-2xl md:text-3xl font-bold text-gray-900 mb-2",children:"Why Choose Our Platform?"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg",children:"Experience the difference with our premium features"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 flex-grow",children:[(0,r.jsx)("div",{className:"bg-white/60 rounded-xl p-4 border border-[#CA24D6]/20 hover:border-[#CA24D6]/40 transition-all duration-300 hover:shadow-md",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-xl bg-gradient-to-br from-[#CA24D6]/20 to-[#eaa8f9]/20 flex items-center justify-center",children:(0,r.jsx)(u.A,{className:"w-5 h-5 text-primary"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"text-gray-900 font-semibold mb-1",children:"No Setup Fees"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm leading-relaxed",children:"Get started immediately without any hidden costs or complicated setup processes"})]})]})}),(0,r.jsx)("div",{className:"bg-white/60 rounded-xl p-4 border border-[#CA24D6]/20 hover:border-[#CA24D6]/40 transition-all duration-300 hover:shadow-md",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-xl bg-gradient-to-br from-[#CA24D6]/20 to-[#eaa8f9]/20 flex items-center justify-center",children:(0,r.jsx)(x.A,{className:"w-5 h-5 text-primary"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"text-gray-900 font-semibold mb-1",children:"Cancel Anytime"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm leading-relaxed",children:"No long-term contracts or commitments. Cancel your subscription whenever you want"})]})]})}),(0,r.jsx)("div",{className:"bg-white/60 rounded-xl p-4 border border-[#CA24D6]/20 hover:border-[#CA24D6]/40 transition-all duration-300 hover:shadow-md",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-xl bg-gradient-to-br from-[#CA24D6]/20 to-[#eaa8f9]/20 flex items-center justify-center",children:(0,r.jsx)(h.A,{className:"w-5 h-5 text-primary"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"text-gray-900 font-semibold mb-1",children:"Secure Payments"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm leading-relaxed",children:"Your payment information is always protected with bank-level encryption and security"})]})]})})]})]})]})]})]})]})})}function S(){let{isExpanded:e}=(0,l.c)();return(0,r.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,r.jsx)(i.e,{}),(0,r.jsxs)("div",{className:"flex flex-col flex-1 w-0 ".concat(e?"md:ml-64":"md:ml-20"),style:{paddingTop:64},children:[(0,r.jsx)(n.V,{}),(0,r.jsx)("main",{className:"flex-1 overflow-auto",children:(0,r.jsx)(_,{})})]})]})}function A(){return(0,r.jsx)(l.G,{children:(0,r.jsx)(S,{})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[134,644,121,457,323,669,636,593,792],()=>s(18066)),_N_E=e.O()}]);